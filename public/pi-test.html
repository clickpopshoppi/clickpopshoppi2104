<!DOCTYPE html>
<html>
<head>
    <title>Click Pop Shop Pi Test Token</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { text-align: center; font-family: Arial, sans-serif; padding-top: 50px; }
        .success { color: green; font-size: 20px; }
        .error { color: red; font-size: 20px; }
        .button {
            background-color: #9200ff;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
        }
    </style>
    <script src="https://sdk.minepi.com/v2/pi-sdk.js"></script>
</head>
<body>
    <h1>Click Pop Shop Pi</h1>
    <p>Welcome to the Pi-powered shopping experience!</p>

    <div id="status">Ready for Pi Wallet Connection.</div>
    <br>
    <button id="connectButton" class="button">Connect Pi Wallet</button>
    <button id="payButton" class="button" style="display: none;">Pay with Pi (0.01 Fee)</button>

    <script>
        const statusDiv = document.getElementById('status');
        const connectButton = document.getElementById('connectButton');
        const payButton = document.getElementById('payButton');
        let authData = null;

        // 1. Initialize Pi SDK with Correct App ID
        Pi.init({
            apiKey: "E121e1757cffc8778670efc6ea56b98e5e0736734f6a62ac4bcd2406867f1644e11232505cf5679699538c4092c92039b62b5226a1a2d8a06209221330271ed1"
        });

        // Event Listeners
        connectButton.addEventListener('click', piAuthenticate);
        payButton.addEventListener('click', piCreatePayment);

        function piAuthenticate() {
            statusDiv.innerHTML = 'Connecting...';
            Pi.authenticate(['username', 'payments'], onAuth);
        }

        function onAuth(data) {
            authData = data;
            if (authData && authData.user) {
                statusDiv.innerHTML = `<span class="success">Wallet Connected! Username: ${authData.user.username}</span>`;
                connectButton.style.display = 'none';
                payButton.style.display = 'inline-block';
            } else {
                statusDiv.innerHTML = '<span class="error">Wallet Connection Failed.</span>';
            }
        }

        function piCreatePayment() {
            statusDiv.innerHTML = 'Preparing Test Payment...';

            const paymentData = {
                amount: 0.01,
                memo: 'Test Token for Click Pop Shop Pi',
                metadata: {
                    orderId: 'TEST_TOKEN_PAYMENT_123'
                }
            };

            const callbacks = {
                onReadyForServerApproval: function(paymentId) {
                    // In a real app, this would send paymentId to your server for approval
                    statusDiv.innerHTML = `<span class="success">Payment ID ${paymentId} Ready. Please Confirm in Wallet.</span>`;
                    // For Test Token, Pi automatically approves it, so just wait for completion
                },
                onReadyForServerCompletion: function(paymentId, txid) {
                    // In a real app, this confirms payment with your server
                    statusDiv.innerHTML = `<span class="success">TEST TOKEN PASSED! Payment Completed (TXID: ${txid})</span>`;
                    payButton.style.display = 'none';
                },
                onCancel: function(paymentId) {
                    statusDiv.innerHTML = '<span class="error">Payment Cancelled.</span>';
                },
                onError: function(error, payment) {
                    statusDiv.innerHTML = `<span class="error">Payment Failed: ${error}</span>`;
                }
            };

            Pi.inappPayments.createPayment(paymentData, callbacks);
        }
    </script>
</body>
</html>
